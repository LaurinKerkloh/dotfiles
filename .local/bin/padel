#!/bin/bash

available=$(
  curl --silent https://unisport.koeln/e65/e35801/e35916/e35928/publicXMLData |
    xq '.' |
    jq '
            .angebotsdaten
            .angebote
            .angebot
            | map(
                select(
                    .angebotsname == "Padel" and
                    .details == "Platzmiete"
                )
            )
            | map(
                map_values(
                    if type == "array" then map(select(. != null))
                    | if length == 1 then .[0] else . end else . end
                )
            )
            | map(. | {buchung, frei, kursid, kursnr, tag, uhrzeit, zeitraum})
            | map(select(.zeitraum | contains("2024")))
            | length
            | . != 0
        '
)
if [ "$available" = "true" ]; then
  notify-send "Padelplätze verfügbar"
fi
